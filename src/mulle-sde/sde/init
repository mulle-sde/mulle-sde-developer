#! /usr/bin/env mulle-bash
# shellcheck shell=bash

[ "${TRACE}" = 'YES' ] && set -x && : "$0" "$@"



setup_gitattributes()
{
   local text

   if [ -f .gitattributes ]
   then
      rexekutor grep -F -q -e 'generated by mulle-sde' .gitattributes
      case $? in
         0)
            return 0
         ;;
      esac
   fi

   text='# ### > generated by mulle-sde (extensions/mulle-sde/sde/init)
# Protect some binary test files

*.stderr    binary
*.stdout    binary

# Tweak GitHub language statistics

# .inc is generally C

*.inc       linguist-language=C

# remove boring files
.mulle/**   linguist-generated
.vscode/**  linguist-generated
cmake/**    linguist-generated

# ### < generated by mulle-sde (extensions/mulle-sde/sde/init)
'

   redirect_append_exekutor .gitattributes printf "%s\n" "${text}"
}


setup_gitignore()
{
   log_entry "setup_gitignore" "$@"

   rexekutor grep -F -q -s -e 'generated by mulle-sde' .gitignore
   case $? in
      0)
         return 0
      ;;
   esac

   local text


   text='.gitignore

# ### > generated by mulle-sde (extensions/mulle-sde/sde/init)

# .mulle/var directory is not interesting
var/

# per-user/per-host tweaks are probably not interesting in the repository

environment-user-*.sh
environment-host-*.sh
!environment-host-ci-*.sh

# stash is generally boring
stash/

# build stuff is boring too
build/
kitchen/
dependency/
addiction/
*.tmp/
tmp.*/
.mulle-make-build-dir

# test exe files are boring

test*/**/*.exe

# ### < generated by mulle-sde (extensions/mulle-sde/sde/init)
'

   redirect_append_exekutor .gitignore printf "%s\n" "${text}"
}


main()
{
   while [ $# -ne 0 ]
   do
      if options_technical_flags "$1"
      then
         shift
         continue
      fi

      case "$1" in
         --f)
            MULLE_FLAG_MAGNUM_FORCE='YES'
         ;;

         --marks)
            shift
         ;;

         -*)
            fail "unknown flag \"$1\""
         ;;
      esac

      shift
   done

   options_setup_trace "${MULLE_TRACE}" && set -x

   setup_gitignore
   setup_gitattributes
}


main "$@"
